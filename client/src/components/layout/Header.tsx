import { useState, useEffect } from 'react';
import { Link, useLocation } from 'wouter';
import { ChevronDown } from 'lucide-react';
import { motion, AnimatePresence } from 'framer-motion';
import { Button } from '@/components/ui/button';
import { ThemeToggle } from '@/components/ui/theme-toggle';
import MegaMenu from '@/components/ui/mega-menu';
import AnimatedHamburger from '@/components/ui/animated-hamburger';

const scrollToTop = () => {
  window.scrollTo({ top: 0, behavior: 'smooth' });
};

export default function Header() {
  const [location] = useLocation();
  const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);
  const [isMegaMenuOpen, setIsMegaMenuOpen] = useState(false);
  const [isScrolled, setIsScrolled] = useState(false);

  useEffect(() => {
    const handleScroll = () => {
      setIsScrolled(window.scrollY > 50);
    };

    window.addEventListener('scroll', handleScroll);
    return () => window.removeEventListener('scroll', handleScroll);
  }, []);

  const navigation = [
    { name: 'Accueil', href: '/' },
    { name: 'Offres', href: '/offres' },
    { name: 'Réalisations', href: '/realisations' },
    { name: 'Blog', href: '/blog' },
    { name: 'À propos', href: '/a-propos' },
    { name: 'FAQ', href: '/faq' },
    { name: 'Contact', href: '/contact' },
  ];

  return (
    <>
      {/* Overlay pour le menu mobile */}
      <AnimatePresence>
        {isMobileMenuOpen && (
          <motion.div
            className="fixed inset-0 bg-black/20 backdrop-blur-sm z-30 md:hidden"
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
            transition={{ duration: 0.2 }}
            onClick={() => setIsMobileMenuOpen(false)}
          />
        )}
      </AnimatePresence>

      <header className={`fixed top-0 left-0 right-0 bg-background/95 backdrop-blur-md border-b border-border z-40 transition-all duration-300 ${isScrolled ? 'header-compact' : ''}`}>
        <div className={`container mx-auto px-6 transition-all duration-300 ${isScrolled ? 'py-2' : 'py-4'}`}>
        <nav className="flex items-center justify-between">
          {/* Logo */}
          <Link href="/" className="flex items-center space-x-4 group" onClick={scrollToTop}>
            {/* Logo complet original */}
            <svg 
              width="588.13232" 
              height="131.89922" 
              viewBox="0 0 588.13232 131.89922"
              className={`transition-all duration-300 hover:scale-105 ${
                isScrolled ? 'h-6 sm:h-7' : 'h-7 sm:h-8'
              }`}
              xmlns="http://www.w3.org/2000/svg"
            >
              <defs>
                <style>{`
                  .logo-text-black { 
                    fill: #000000;
                    transition: fill 0.3s ease;
                  }
                  .dark .logo-text-black {
                    fill: #ffffff !important;
                  }
                `}</style>
              </defs>
              <g transform="translate(-6.9859491,-11.817117)">
                <g transform="matrix(1.1147441,0,0,1.1147441,-300.86782,-752.23892)">
                  <path
                    className="logo-text-black"
                    strokeWidth="0.47717"
                    d="m 752.23988,803.40187 -1.74965,-0.26502 v -6.0019 -6.00189 h 3.56218 c 6.0101,0 9.2447,-2.4163 11.94658,-8.92418 0.93018,-2.24055 0.91421,-2.28707 -11.10595,-32.33997 -6.62064,-16.55289 -12.038,-30.1446 -12.03862,-30.20377 0,-0.0592 3.66304,-0.021 8.14147,0.0851 l 8.14259,0.19264 3.43405,9.03263 c 1.88873,4.96791 5.36029,14.47233 7.7146,21.12093 3.6786,10.38843 4.36114,11.86464 4.85377,10.49775 0.31532,-0.87484 3.41234,-10.3786 6.88227,-21.1195 l 6.30905,-19.52896 7.6415,-0.19411 c 4.20282,-0.10674 7.70444,-0.17885 7.78135,-0.16023 0.077,0.0186 -0.86673,2.73848 -2.09702,6.04412 -1.23028,3.3057 -6.83303,18.60763 -12.4506,34.00434 -5.61759,15.39666 -11.07827,29.62941 -12.13487,31.62822 -4.91123,9.29074 -14.06731,13.76464 -24.8327,12.13381 z M 286.13186,794.0793 c -3.23989,-1.17246 -6.77994,-4.46383 -8.4509,-7.85728 l -1.49783,-3.0418 v -42.62719 -42.62719 l 1.69422,-3.61423 c 1.88289,-4.01658 5.44768,-7.08102 9.50957,-8.17479 1.57021,-0.42281 17.77205,-0.58953 46.18744,-0.47529 43.46412,0.17475 43.78656,0.18554 46.31374,1.54921 2.97784,1.60688 5.42493,4.09919 7.08492,7.21582 1.12401,2.11034 1.18603,4.50587 1.18603,45.80833 0,43.46362 -0.004,43.58844 -1.37576,46.12647 -0.75667,1.39968 -2.33133,3.46086 -3.49924,4.5804 -4.35225,4.1719 -2.317,4.01362 -50.93347,3.96023 -32.92446,-0.0363 -44.62058,-0.24431 -46.21872,-0.82269 z m 82.48071,-18.56988 1.41401,-0.99043 v -33.00228 c 0,-29.15375 -0.11659,-33.11885 -0.99978,-34.00204 -0.88525,-0.88525 -5.10856,-0.99977 -36.86508,-0.99977 h -35.86529 l -0.99041,1.41401 c -0.86484,1.23472 -0.99042,5.51025 -0.99042,33.72003 0,31.45768 0.0333,32.33939 1.27245,33.57841 1.24176,1.2418 2.12076,1.27248 36.44148,1.27248 30.80099,0 35.34465,-0.12302 36.58304,-0.99041 z m -64.39939,-15.69304 c -1.14447,-1.63396 -1.2759,-3.86225 -0.3318,-5.62631 0.62356,-1.16515 1.48585,-1.23063 16.20141,-1.23063 14.71554,0 15.57783,0.0655 16.20139,1.23063 1.03487,1.93364 0.77457,4.37946 -0.61385,5.76785 -1.1985,1.1985 -2.12075,1.27246 -15.86958,1.27246 -14.36304,0 -14.61303,-0.0224 -15.58757,-1.414 z m 0.28204,-17.6728 c -1.52218,-1.52218 -1.64685,-4.27216 -0.28204,-6.22068 l 0.99042,-1.41404 h 26.90496 c 25.25708,0 26.96945,0.0713 27.9579,1.16348 1.44873,1.6008 1.33628,4.91548 -0.21949,6.47124 -1.23159,1.23157 -2.12077,1.27246 -27.67588,1.27246 -25.55511,0 -26.44429,-0.0411 -27.67587,-1.27246 z m -0.28204,-18.59212 c -1.36481,-1.94858 -1.24014,-4.69856 0.28204,-6.22073 1.23192,-1.23191 2.12076,-1.27242 27.89538,-1.27242 24.98385,0 26.68775,0.0716 27.67586,1.16347 1.423,1.57238 1.36042,5.35954 -0.11054,6.69074 -1.04387,0.94466 -3.91826,1.05293 -27.95791,1.05293 H 305.2036 Z m 235.04974,56.88387 c -5.30701,-1.38712 -9.16304,-3.67106 -12.84645,-7.60895 -5.51857,-5.89978 -7.61246,-12.07609 -7.59802,-22.41187 0.005,-4.07943 0.40383,-8.14806 1.02255,-10.45007 2.11317,-7.86215 7.23432,-14.68481 13.54883,-18.0504 14.80181,-7.88929 30.84161,-3.43529 37.68436,10.46429 2.20704,4.48311 3.81743,11.84699 3.81743,17.45594 v 3.76139 h -20.75868 -20.75869 l 0.41628,2.6033 c 0.8934,5.58699 5.03644,10.68282 9.74953,11.99166 6.86143,1.90545 13.85776,-0.30301 17.22286,-5.43654 l 1.39151,-2.12278 5.1776,2.18367 c 2.84768,1.20099 5.31888,2.32491 5.49156,2.49756 0.56871,0.56873 -2.88833,5.81431 -5.65552,8.58152 -6.54353,6.54353 -17.80088,9.18237 -27.90515,6.54128 z m 20.58305,-39.08706 c -0.7039,-3.82381 -2.60111,-7.28304 -4.99626,-9.10995 -1.88967,-1.44128 -3.20043,-1.86668 -6.37493,-2.0688 -5.03655,-0.32071 -7.78803,0.58267 -10.72754,3.52218 -1.96954,1.96956 -4.21035,6.86787 -4.21035,9.20356 0,0.28645 6.00518,0.52078 13.34485,0.52078 h 13.34486 z m 49.45368,39.23074 c -4.10443,-1.10351 -7.05927,-2.83196 -9.20912,-5.38692 -0.867,-1.03035 -1.66643,-1.87389 -1.7765,-1.87452 -0.11006,-4.8e-4 -0.20013,1.50247 -0.20013,3.34019 v 3.3413 l -7.47567,0.17928 -7.47565,0.17921 v -43.28357 -43.28363 h 7.6854 7.6854 l -0.20974,15.82797 -0.20974,15.82797 1.27246,-1.36709 c 3.83402,-4.11921 10.99574,-6.43435 18.34582,-5.93056 15.08948,1.03423 24.57347,13.23876 24.57905,31.62966 0.005,16.36263 -8.05248,28.38122 -20.84732,31.09599 -4.39465,0.93243 -7.91573,0.84696 -12.16426,-0.29528 z m 8.08053,-13.33824 c 7.14788,-2.9858 10.92625,-12.35347 9.15318,-22.69321 -1.46858,-8.56425 -5.61733,-13.03247 -12.69674,-13.67441 -6.99155,-0.63397 -11.20655,1.73204 -14.30762,8.0312 -1.84664,3.75108 -2.02444,4.64597 -2.02585,10.19689 -0.002,7.44801 1.30191,11.68514 4.66048,15.14596 1.30964,1.34948 3.36778,2.76821 4.57364,3.15271 3.2409,1.03335 7.95702,0.96287 10.64291,-0.15914 z m -183.39885,12.28112 c -0.14533,-0.43738 -1.72743,-6.52129 -3.51578,-13.5198 -5.08151,-19.88583 -17.30333,-66.71465 -17.64249,-67.59851 -0.23511,-0.61264 1.65999,-0.79587 8.23167,-0.79587 h 8.53709 l 6.80831,29.74359 c 3.74457,16.35897 6.82736,30.3162 6.85065,31.01606 0.0704,2.1173 0.46939,0.73589 8.8188,-30.53889 l 7.98311,-29.90263 7.376,-0.17841 7.37601,-0.17837 2.64317,10.35797 c 7.05882,27.66199 13.79291,51.3502 14.20449,49.96659 0.23477,-0.78919 2.59859,-10.59661 5.2529,-21.79422 2.65432,-11.19756 5.77872,-24.36746 6.94311,-29.26642 l 2.11705,-8.90714 7.42346,-0.17927 c 5.22179,-0.12607 7.42346,0.0349 7.42346,0.54339 0,0.68637 -16.96847,65.86944 -19.94556,76.61932 l -1.40958,5.08978 h -8.24042 -8.24043 l -6.58897,-23.22225 c -9.4314,-33.24015 -9.13584,-32.30504 -9.7458,-30.83622 -0.28589,0.68842 -3.83463,12.84691 -7.88608,27.01885 -4.05147,14.17196 -7.48373,26.12507 -7.62724,26.56245 -0.19105,0.58233 -2.48642,0.79529 -8.57181,0.79529 -6.08364,0 -8.3817,-0.21309 -8.57512,-0.79529 z m 215.98505,-42.46815 v -43.26339 h 7.31664 7.31659 v 43.26339 43.26344 h -7.31659 -7.31664 z m 28.61469,24.51557 c -0.009,-10.33421 -0.0224,-24.01454 -0.031,-30.40064 l -0.0158,-11.61113 h 7.04241 7.04241 v 30.22076 30.22076 l -7.01249,0.17989 -7.01239,0.1799 z m 32.90696,18.34338 c -0.24412,-0.24408 -0.44383,-11.27559 -0.44383,-24.51438 V 731.3277 h -5.24887 -5.24887 l 0.021,-5.88331 0.021,-5.88332 5.38672,-0.31813 5.38673,-0.31809 0.2037,-6.04416 c 0.32324,-9.59022 3.3131,-14.61529 10.26131,-17.24607 3.81702,-1.44521 12.41902,-2.28451 16.18103,-1.57877 l 2.3023,0.43193 v 5.53813 5.53818 h -5.14198 c -5.00323,0 -5.19214,0.056 -6.99852,2.07774 -1.7117,1.91574 -1.85657,2.46153 -1.85777,6.99852 v 4.92072 l 6.9998,-0.19874 6.9998,-0.19874 v 6.08381 6.08389 h -6.99093 -6.99092 l -0.16663,24.33567 -0.16661,24.33568 -7.03187,0.1787 c -3.86751,0.0983 -7.23157,-0.021 -7.47564,-0.26512 z M 681.0406,709.99881 c -2.90558,-1.57819 -4.55387,-4.9835 -4.19914,-8.67532 0.2519,-2.62182 0.7285,-3.6223 2.63255,-5.52631 2.16381,-2.16382 2.59194,-2.32496 6.17735,-2.32496 3.70689,0 3.94681,0.10121 6.35171,2.67935 2.16902,2.32531 2.49923,3.07194 2.49923,5.65094 0,3.51689 -1.81479,6.84706 -4.48346,8.22704 -2.29032,1.18438 -6.76927,1.16901 -8.97824,-0.0305 z"
                  />
                </g>
                <path
                  fill="#4c82ee"
                  strokeWidth="0.532945"
                  d="m 19.091414,133.08416 -1.785508,-0.54994 -2.132454,-1.10337 -2.13246,-1.10338 -1.558584,-1.66222 L 9.9238158,127.003 8.4705329,123.81325 7.0172511,120.62347 7.0016001,73.43494 6.9859491,26.246393 8.1127459,22.95578 8.9789656,19.535524 11.328941,16.289661 14.98178,13.951306 18.592905,12.884211 22.20403,11.817117 h 46.730994 46.731026 l 3.63346,0.937865 3.63351,0.937852 2.87688,2.267278 2.87691,2.267288 1.65885,3.3516 1.65888,3.351587 0.19804,46.356253 0.19806,46.35626 -1.06402,3.6167 -1.06402,3.61669 -2.23046,2.67873 -2.23042,2.6787 -2.27942,2.06828 -3.76131,1.45081 -49.261814,0.12577 -49.632273,-0.24468 z m 91.308256,-21.07657 1.16205,-1.17312 0.14067,-36.96226 -0.67541,-36.525265 -0.49726,-0.890328 -1.05347,-0.373851 -39.894493,-0.874056 -40.265704,0.217901 -0.828882,1.186523 -0.586774,1.210733 -0.702125,35.957763 0.266323,34.11771 0.76997,3.73018 1.859478,1.13959 39.029339,0.41159 39.903248,-0.42201 z M 37.578286,93.58562 36.86218,91.71143 l 0.610743,-2.61927 0.975492,-2.16333 17.206096,0.18968 17.297275,0.0985 1.487249,1.72127 0.347421,2.31398 -0.503399,2.35455 -1.187298,1.85301 -2.491616,0.91187 -31.534662,-0.0912 z m 0.51375,-18.73797 -0.759679,-1.49425 -0.227967,-2.30286 0.227967,-2.39403 0.942053,-1.1295 0.942052,-1.12949 H 69.364001 99.51154 l 1.10893,1.57539 1.10892,1.57539 v 1.66098 1.66096 l -0.73741,1.37107 -1.056581,1.64464 -3.162962,0.59272 -56.689699,-0.13678 z m 1.237897,-18.99662 -1.601297,-1.51217 -0.441267,-1.99914 -0.441263,-1.99916 0.72414,-1.895229 1.742023,-1.844335 5.569698,-0.556921 54.916651,0.0045 1.193362,1.87259 0.73741,1.371074 v 1.660981 1.66097 l -0.74417,1.66658 -1.47368,1.4842 -29.47253,0.20637 -29.563713,0.0241 z"
                />
              </g>
            </svg>
            
            {/* Texte "Weblify Studio" en ligne horizontale */}
            <div className="flex items-center space-x-2">
              <span className={`font-inter font-medium text-black dark:text-white transition-colors duration-300 ${
                isScrolled ? 'text-2xl sm:text-3xl' : 'text-3xl sm:text-4xl'
              }`}>
                Weblify
              </span>
              <span className={`font-inter font-medium text-black dark:text-white transition-colors duration-300 ${
                isScrolled ? 'text-2xl sm:text-3xl' : 'text-3xl sm:text-4xl'
              }`}>
                Studio
              </span>
            </div>
          </Link>

          {/* Desktop Navigation */}
          <div className="hidden md:flex items-center space-x-8">
            {navigation.map((item) => (
              <Link
                key={item.name}
                href={item.href}
                onClick={scrollToTop}
                className={`header-link transition-colors duration-200 ${
                  location === item.href
                    ? 'text-primary font-medium'
                    : 'text-muted-foreground hover:text-primary'
                }`}
              >
                {item.name}
              </Link>
            ))}
          </div>

          {/* Desktop Actions */}
          <div className="hidden md:flex items-center space-x-4">
            <ThemeToggle />
          </div>

          {/* Mobile Actions */}
          <div className="md:hidden flex items-center space-x-4">
            <ThemeToggle />
            <Button
              variant="ghost"
              size="icon"
              onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)}
              className="h-10 w-10 relative"
            >
              <AnimatedHamburger isOpen={isMobileMenuOpen} />
            </Button>
          </div>
        </nav>

        {/* Mobile Navigation */}
        <AnimatePresence>
          {isMobileMenuOpen && (
            <motion.div
              className="md:hidden border-t border-border overflow-hidden"
              initial={{ height: 0, opacity: 0 }}
              animate={{ height: "auto", opacity: 1 }}
              exit={{ height: 0, opacity: 0 }}
              transition={{
                duration: 0.4,
                ease: [0.25, 0.1, 0.25, 1],
              }}
            >
              <motion.div
                className="flex flex-col space-y-3 pt-4 pb-4"
                initial={{ y: -20 }}
                animate={{ y: 0 }}
                exit={{ y: -20 }}
                transition={{
                  duration: 0.4,
                  ease: [0.25, 0.1, 0.25, 1],
                  delay: 0.1,
                }}
              >
                {navigation.map((item, index) => (
                  <motion.div
                    key={item.name}
                    initial={{ opacity: 0, x: -20 }}
                    animate={{ opacity: 1, x: 0 }}
                    exit={{ opacity: 0, x: -20 }}
                    transition={{
                      duration: 0.4,
                      ease: [0.25, 0.1, 0.25, 1],
                      delay: index * 0.08,
                    }}
                  >
                    <Link
                      href={item.href}
                      onClick={() => {
                        setIsMobileMenuOpen(false);
                        scrollToTop();
                      }}
                      className={`header-link py-2 block transition-colors duration-200 ${
                        location === item.href
                          ? 'text-primary font-medium'
                          : 'text-muted-foreground hover:text-primary'
                      }`}
                    >
                      {item.name}
                    </Link>
                  </motion.div>
                ))}
              </motion.div>
            </motion.div>
          )}
        </AnimatePresence>
        </div>
      </header>
    </>
  );
}
